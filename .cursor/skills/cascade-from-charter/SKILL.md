---
name: cascade-from-charter
description: 规划并执行全项目级联更新，使文档与代码与固定宪章（如 docs/ARCHITECTURE.md）一致。先对文件排优先级、按优先级拆分任务，再在每个任务内分析不一致、修改、校验一致性与结构。当用户完成宪章/方案修改并希望把变更级联到全项目，或提到方案修改完、宪章、按方案修改文档、全项目对齐时使用。
---

# 按宪章级联更新

当宪章文件（如 `docs/ARCHITECTURE.md`）已定稿且不再修改时，用本技能将项目其余部分与宪章对齐。

**宪章不可动**：宪章文件是唯一权威来源，本流程中不得修改宪章。

---

## 流程概览

```
1. 排优先级  →  2. 规划任务  →  3. 逐任务执行（内层循环）  →  4. 整体收尾
```

---

## 阶段一：对全项目文件排优先级

- 列出所有可能需要与宪章对齐的项目文件（文档、配置、代码、技能、脚本等）。
- 排除：宪章文件本身、二进制/资源、生成文件及无关路径（如 `.git`、`node_modules`）。
- 为每个文件或分组赋予**优先级**（如 高 / 中 / 低），依据：
  - **影响面**：定义结构、入口或核心行为的文件优先。
  - **依赖关系**：被其他文件依赖的（如 README、主配置）优先于叶子文件。
  - **用户提示**：若用户指明重要区域，则提高其优先级。
- 输出：供下一阶段使用的**按优先级排序的文件列表**（或分组列表）。

---

## 阶段二：规划任务（此处不做单文件分析）

- 按优先级将工作拆成**任务**。每个任务可对应一个文件或一小批相关文件（如一个文档或一个目录）。
- 任务顺序与阶段一的优先级一致（高 → 中 → 低）。
- 每个任务只记录：**范围**（涉及哪些文件）和**优先级**。**不要**在此阶段分析不一致或规划具体修改，那在阶段三的每个任务内部完成。
- 输出：将逐项执行的**任务列表**（如 markdown 清单）。

---

## 阶段三：执行每个任务（内层循环）

对**每个**任务按顺序执行以下步骤，不可跳过校验。**核心**：以开发者思维理解宪章意图，做出合理设计，再落笔修改；避免机械对照、逐条替换。

**3.1 理解宪章并做设计判断**

- 阅读宪章与本任务涉及的文件，把握宪章中的**原则、结构和约定**（术语、目录、流程、角色、路径等）。
- 从**设计角度**思考：在这一处（这篇文档/这段逻辑）里，宪章希望呈现什么？当前内容为何会偏离？更合理的组织方式是什么？
- 形成**设计结论**：要保留/强化什么、要删减/合并什么、要新增什么，以及整体结构或表述应如何调整，使结果既符合宪章又在该上下文中自然、可维护。

**3.2 按设计修改**

- 依据 3.1 的设计结论落笔修改，而不是机械地「找不同再改」。保证修改后的内容在语义和结构上与宪章一致，且读起来像是有意设计而非拼贴。

**3.3 校验与宪章的对齐**

- 将更新后的内容再次对照宪章检查：原则、术语、结构、示例是否一致。
- 若有偏差，先回到「宪章在这里的意图是什么」再调整，而不是单纯补词。

**3.4 自检结构与内容**

- 检查：清晰度、正确性、冗余，以及是否有更合理的信息结构或表述方式。
- 在不违背宪章的前提下，用开发者/写作者的判断优化表述、标题或顺序，使文档或代码更易读、更一致。

**3.5 再次校验**

- 针对本任务范围做最后一轮与宪章的一致性检查（原则 + 术语 + 结构）。
- 仅当**设计对齐**与**质量**都通过后再将该任务标为完成。

然后进入下一个任务。

---

## 阶段四：整体收尾

所有任务完成后，按以下顺序做收尾。

**4.1 查漏：与宪章对照的遗漏与缺口**

- 对照宪章逐项检查是否有**未整改到位**的部分：
  - 宪章中已说明、但项目中**尚未创建**的文件或目录（需补齐或记录为待办）。
  - 宪章中有约定、但当前实现或文档仍**不满足**的地方（不一致、缺失、错误引用等）。
- 列出遗漏清单，能在本轮补齐的即补齐，否则记入遗留/后续事项。

**4.2 终审：对本次修改内容做质检**

- 从以下维度对已修改内容做**最后评审**：
  - **完备**：该有的说明、引用、示例是否都到位，无缺项。
  - **正确**：事实、术语、路径、流程是否与宪章一致且无错误。
  - **去冗余**：是否存在重复、废话或可合并的段落，能删则删、能并则并。
  - **结构合理**：章节划分、顺序、层级是否清晰，是否符合读者/使用者的认知顺序。
- 发现问题即修正，必要时再对宪章做一次一致性核对。

**4.3 汇总**

- 汇总本次更新范围、补漏与终审结论，以及遗留风险或后续事项。

---

## 任务进度模板

用以下清单跟踪执行进度：

```markdown
## 级联进度

**宪章：** [路径，如 docs/ARCHITECTURE.md]（不修改）

### 阶段一 – 优先级列表
- [ ] 已产出并确认优先级列表

### 阶段二 – 任务规划
- [ ] 任务 1（高）：[范围]
- [ ] 任务 2（高）：[范围]
- [ ] 任务 3（中）：[范围]
- [ ] …

### 阶段三 – 执行
- [ ] 任务 1 完成（分析 → 修改 → 校验 → 自检 → 再校验）
- [ ] 任务 2 完成
- [ ] …

### 阶段四 – 整体收尾
- [ ] 4.1 查漏完成（宪章有而项目无的、未满足宪章的已处理或记录）
- [ ] 4.2 终审完成（完备、正确、去冗余、结构合理）
- [ ] 4.3 已汇总更新范围与遗留/后续事项
```

---

## 使用方式

- 用户说明宪章已定稿并给出路径（如 `docs/ARCHITECTURE.md`）时，从阶段一开始。
- 若用户只要**计划**：只做阶段一和阶段二，输出任务列表；不开始阶段三，等用户明确要求执行再动。
- 若用户要**完整执行**：按 1 → 2 → 3（全部任务）→ 4 顺序跑完。
