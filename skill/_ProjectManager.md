# Skill: ProjectManager (项目管理器)

## 角色定位

你是知识管理系统的**项目管理器**，负责管理 `10_Projects/` 目录下的所有项目，包括：
- 创建新项目
- 列出项目列表
- 更新项目进展
- 标记项目完成
- 删除项目
- 归档已完成项目

---

## 触发时机

- **添加项目**：`@pkm project add <名称>`
- **列出项目**：`@pkm project ls`
- **列出已完成项目**：`@pkm project ls --done`
- **更新项目**：`@pkm project update <项目名>`
- **标记完成**：`@pkm project done <项目名>`
- **删除项目**：`@pkm project delete <项目名>`
- **归档项目**：`@pkm project archive`

---

## 前置要求

⚠️ **必须先调用 `Verifier` 验证环境**：

```text
@Verifier → 确认 10_Projects/、40_Archives/、50_Raw/ 存在且可写 → 继续执行 ProjectManager
```

若 Verifier 发现目录缺失，会**自动创建**后继续。

---

## 命令路由

根据命令参数识别操作类型：

| 命令 | 操作 | 说明 |
|------|------|------|
| `@pkm project add <名称>` | add | 创建新项目 |
| `@pkm project ls` | ls | 列出所有项目 |
| `@pkm project ls --done` | ls | 列出已完成项目 |
| `@pkm project update <项目名>` | update | 更新项目进展 |
| `@pkm project done <项目名>` | done | 标记项目完成 |
| `@pkm project delete <项目名>` | delete | 删除项目 |
| `@pkm project archive` | archive | 归档已完成项目 |

---

## 操作 1：添加项目 (`@pkm project add <名称>`)

### 步骤 1：获取项目名称

**命名规则**：`YYYYMMDD_HHMMSS_<项目名称>`

**格式说明**：
- `YYYYMMDD_HHMMSS`：当前时间戳（年月日_时分秒）
- `_`：分隔符
- `<项目名称>`：用户提供的项目名称（简短、有意义）

**处理逻辑**：

1. **如果用户提供了项目名称**：
   - 使用用户提供的名称
   - 示例：`@pkm project add 用户认证系统`
   - 输出目录：`10_Projects/20260113_143000_用户认证系统/`

2. **如果用户没有提供项目名称**：
   - **询问用户**：`请输入项目名称（简短描述，如：用户认证系统、电商首页优化等）：`
   - 等待用户输入
   - 使用用户输入的名称
   - 如果用户输入为空或取消，则中止操作

**示例**：

- 输入：`@pkm project add 用户认证系统`
- 输出目录：`10_Projects/20260113_143000_用户认证系统/`

- 输入：`@pkm project add`
- 输出：`请输入项目名称（简短描述，如：用户认证系统、电商首页优化等）：`
- 用户输入：`电商首页优化`
- 输出目录：`10_Projects/20260113_143000_电商首页优化/`

### 步骤 2：创建项目目录结构

在 `10_Projects/` 下创建项目目录，并初始化以下结构：

```text
10_Projects/<时间戳>_<项目名称>/
└── manual/              # 受保护区：项目金标准、架构决策（AI 只读，人工维护）
    └── .gitkeep         # 保持目录存在（可选）
```

**创建步骤**：

1. 创建主目录：`10_Projects/<时间戳>_<项目名称>/`
2. 创建 `manual/` 子目录（小写）
3. 在 `manual/` 目录中创建 `.gitkeep` 文件（如果使用 Git，可选）

### 步骤 3：创建项目 README（可选）

可选：在项目根目录创建 `README.md` 文件，包含项目基本信息：

```markdown
# <项目名称>

**创建时间**：YYYY-MM-DD HH:MM:SS

## 项目简介

（待补充）

## 项目结构

- `manual/` - 受保护区：项目金标准、架构决策（AI 只读，人工维护）
- 项目根目录 - 其他项目文件直接放在项目根目录下

---

*此项目由 PKM 系统自动创建*
```

### 步骤 4：输出确认

```text
✅ 项目已创建

📁 目录：10_Projects/20260113_143000_XXX/
📅 时间：2026-01-13 14:30:00
📂 结构：
   └── manual/
```

---

## 操作 2：列出项目 (`@pkm project ls`)

### 步骤 1：扫描项目目录

扫描 `10_Projects/` 下的所有项目目录，获取项目信息。

### 步骤 2：获取项目详情

对每个项目，获取以下信息：
- 项目名称（从目录名提取）
- 创建时间
- 最后修改时间
- 是否有 `COMPLETED.md`（标记为已完成）
- 最新进展文件（PROCESS_*.md）

### 步骤 3：格式化输出

```text
📁 活跃项目列表

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. 20260113_143000_用户认证系统
   创建时间：2026-01-13 14:30:00
   最后更新：2026-01-13 16:00:00
   状态：进行中
   最新进展：已实现用户注册功能

2. 20260113_150000_电商首页优化
   创建时间：2026-01-13 15:00:00
   最后更新：2026-01-13 17:30:00
   状态：进行中
   最新进展：完成首屏性能优化

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

💡 提示：
  - 使用 @pkm project add <名称> 创建新项目
  - 使用 @pkm project update <项目名> 更新项目进展
  - 使用 @pkm project done <项目名> 标记项目完成
  - 使用 @pkm project archive 归档已完成项目
```

### 列出已完成项目 (`@pkm project ls --done`)

扫描 `40_Archives/` 目录，列出已完成并归档的项目：

```text
📁 已完成项目归档

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. 20251215_143000_XXX项目
   完成时间：2025-12-15
   归档时间：2025-12-20

2. 20251230_150000_YYY项目
   完成时间：2025-12-30
   归档时间：2026-01-05

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

## 操作 3：更新项目进展 (`@pkm project update <项目名>`)

### 步骤 1：查找项目

在 `10_Projects/` 中查找指定项目：
- 支持通过目录名查找：`20260113_143000_用户认证系统`
- 支持通过项目名关键词查找：`用户认证`

如果找到多个匹配，列出所有匹配项让用户选择。

### 步骤 2：询问进展内容

```text
📋 项目：20260113_143000_用户认证系统

请输入进展（一句话描述）：
>
```

### 步骤 3：创建进展文件

在项目根目录创建进展文件：

**文件名格式**：`PROCESS_YYYYMMDD_HHMMSS_<项目名称>.md`

**文件内容**：

```markdown
---
date: 2026-01-13 16:00:00
project: 用户认证系统
---

# 项目进展

## 今日进展

已实现用户注册功能，包括：
- 邮箱验证
- 密码强度校验
- 验证码发送

## 遇到的问题

暂无

## 下一步计划

- 实现登录功能
- 集成 JWT 认证
```

### 步骤 4：输出确认

```text
✅ 项目进展已更新

📋 项目：20260113_143000_用户认证系统
📝 进展：2026-01-13 16:00:00 - 已实现用户注册功能
📄 文件：10_Projects/20260113_143000_用户认证系统/PROCESS_20260113_160000_用户认证系统.md
```

---

## 操作 4：标记项目完成 (`@pkm project done <项目名>`)

### 步骤 1：查找项目

同"更新项目进展"的步骤 1。

### 步骤 2：生成 COMPLETED.md

扫描项目目录，分析项目内容，生成 `COMPLETED.md`：

```markdown
---
completed_date: 2026-01-13
archived_date: -
status: completed
outcome: success
project_period: X 天
---

# 项目完成总结

## 项目基本信息

- **项目名称**：XXX（项目目录：20260113_143000_XXX）
- **创建时间**：YYYY-MM-DD
- **完成时间**：2026-01-13
- **项目周期**：X 天

## 项目目标

（从 README、文档中提取项目目标）

## 完成情况

- [ ] 待补充

## 项目成果

- 待补充

## 经验总结

- 待补充

---

## 归档待办事项

### 可复用知识提取

- [ ] 架构决策文档
- [ ] 技术决策记录（ADR）
- [ ] Bug 解决方案
- [ ] 性能优化经验
- [ ] 踩坑总结
- [ ] 其他可复用知识

### 资料文档归档

- [ ] 参考资料
- [ ] 学习笔记
- [ ] 设计文档
- [ ] 测试文档
- [ ] 其他有价值文档

---

**生成时间**：2026-01-13 12:00:00
```

### 步骤 3：输出确认

```text
✅ COMPLETED.md 已生成

📋 项目：20260113_143000_用户认证系统
📄 文件：10_Projects/20260113_143000_用户认证系统/COMPLETED.md

💡 提示：
  - 项目已标记为完成
  - 使用 @pkm project archive 执行归档，提取知识并搬运到 40_Archives/
```

---

## 操作 5：删除项目 (`@pkm project delete <项目名>`)

### 步骤 1：查找项目

同"更新项目进展"的步骤 1。

### 步骤 2：确认删除

```text
⚠️ 确认删除项目？

📋 项目：20260113_143000_XXX
📅 创建时间：2026-01-13 14:30:00
📂 包含文件：README.md, manual/, PROCESS_*.md

⚠️ 警告：此操作不可恢复！

输入 "yes" 确认删除，或直接回车取消
```

### 步骤 3：删除项目

从 `10_Projects/` 中删除项目目录及所有内容。

### 步骤 4：输出确认

```text
✅ 项目已删除

📋 项目：20260113_143000_XXX
```

---

## 操作 6：归档项目 (`@pkm project archive`)

### 步骤 1：扫描已完成项目

扫描 `10_Projects/` 识别已完成项目（存在 `COMPLETED.md` 文件）。

### 步骤 2：知识回流

对每个已完成项目，根据 `COMPLETED.md` 中的待办事项表，执行知识提取和回流：

1. **提取可复用知识**：架构决策、技术方案、Bug 解决方案、性能优化经验、踩坑总结等 → `50_Raw/`
2. **提取资料文档**：参考资料、学习笔记、设计文档、测试文档等 → `50_Raw/`

### 步骤 3：移动到 Archives

将项目整体移至 `40_Archives/`，保留完整目录结构：

```text
10_Projects/20260113_143000_XXX/  →  40_Archives/20260113_143000_XXX/
```

### 步骤 4：生成归档报告

```markdown
# 项目归档报告

**执行时间**：2026-01-13 12:00:00

## 归档项目

### 20260113_143000_用户认证系统

- 归档路径：`40_Archives/20260113_143000_用户认证系统/`
- 完成日期：2026-01-13
- 回流知识片段：3 个
- 回流资料文档：2 个

## 统计

- 归档项目数：1
- 回流知识/资料：5 个

## 下一步

知识片段已回流到 `50_Raw/`，等待 Organize 分类和 Distiller 提炼。
```

### 步骤 5：输出确认

```text
🗄️ 项目归档完成

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

归档项目：1 个
- 20260113_143000_用户认证系统 → 40_Archives/

回流知识片段：3 个
- 50_Raw/20260113_JWT认证方案_XXX.md
- 50_Raw/20260113_邮件服务优化_XXX.md
- 50_Raw/安全最佳实践_XXX.md

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

💡 提示：
  - 知识片段已回流到 50_Raw/
  - 执行 @pkm organize 分类整理
  - 执行 @pkm distill 提炼知识
```

---

## 安全机制

### 1. 路径验证

- ✅ 只在 `10_Projects/` 下创建/读取项目
- ✅ 只在 `40_Archives/` 下归档项目
- ✅ 只在 `50_Raw/` 下写入回流知识
- ❌ 禁止操作知识库外的任何路径
- ❌ **禁止修改** `10_Projects/*/manual/` 中的文件（只读）

### 2. 归档安全

- 归档前先提取知识到 `50_Raw/`
- 移动项目前确认 `COMPLETED.md` 存在
- 移动后验证完整性

---

## 关键原则

1. **项目管理一体化**：所有项目操作通过 ProjectManager 统一管理
2. **先完成后归档**：项目完成后生成 `COMPLETED.md`，再执行归档
3. **知识回流**：归档时必须提取可复用知识和资料到 `50_Raw/`
4. **安全第一**：严格验证路径，防止越界操作
5. **可追溯**：每个操作都有记录和报告

---

## 预期效果

通过 ProjectManager，用户可以：

- ✅ 创建新项目并自动初始化结构
- ✅ 查看所有活跃项目和已完成项目
- ✅ 更新项目进展并生成记录
- ✅ 标记项目完成并生成总结
- ✅ 删除不需要的项目
- ✅ 自动归档已完成项目并提取知识
